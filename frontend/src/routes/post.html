<template>
    <require from="converters/markdown-format"></require>
    <section class="contentArea">
        <div class="post" show.bind="post != undefined">
            <center><div class="titleLink">
                <div class="header">
                    <img class="headerImage" src="${post.heroPhotoUrl}"></img>
                    <div class="postTitle">${post.title}</div>
                </div>
            </div></center>
            <p class="grey">by ${post.author} on ${secondsToDate(post.date)} at ${secondsToTime(post.date)}</p>
            <a if.bind="isAuthenticated" route-href="route: editor; params.bind: getLinkParams(post)">edit</a>
            <div>
                <div class="mapButton" click.trigger="toggleMap()">${post.location}</div>
                <google-map if.bind="mapLoaded" show.bind="mapShown" address.bind="post.location" zoom="7"></google-map>
            </div>
            <p>
                <div innerhtml.bind="post.content | markdownFormat"></div>
            </p>
            <div show.bind="post.dateLastEdited != undefined"> 
                <p class="grey">Updated on ${secondsToDate(post.dateLastEdited)} at ${secondsToTime(post.dateLastEdited)}</p>
            </div>
            <div class="nextPrevLink">
                <a if.bind="prevPost" route-href="route: post; params.bind: { id: prevPost.id }" class="left"><< ${prevPost.title}</a>
                <a if.bind="nextPost" route-href="route: post; params.bind: { id: nextPost.id }" class="right">${nextPost.title} >></a>
            </div>
        </div>
        <div class="post" show.bind="post == undefined">
            Couldn't find that post. Sorry :(
        </div>
    </section>
    <section class="comments">
        <p class="small">Talk in the boxes down there. We'll talk back!</p>
        <h3>${post.comments.length} comment${post.comments.length == 1 ? "" : "s"}</h3>
        <div class="comment" repeat.for="comment of post.comments">
            <div class="grey">#${$index+1} ${comment.name}</div>
            <div class="grey">${secondsToDate(comment.date)} at ${secondsToTime(comment.date)}</div>
            <div>${comment.content}</div>
            <button if.bind="isAuthenticated" click.trigger="deleteComment(comment)">delete</button>
        </div>
    </section>
    <section class="postComment">
        <p><input class="textbox" placeholder="Name" value.bind=comment.name></input></p>
        <p><input class="textbox" placeholder="Email(optional)" value.bind="comment.email"></input></p>
        <p><textarea class="textarea" placeholder="Comment" value.bind="comment.content"></textarea></p>
        <p><button click.trigger="submitComment()">Submit Comment</button></p>
    </section>
</template>